<!doctype html>
<html lang="en-US">
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="http://maia.maiascript.com:8015/cnatool/css/menu.css">
   <link rel="stylesheet" href="http://maia.maiascript.com:8015/cnatool/css/split.css">
   <link rel="stylesheet" href="http://maia.maiascript.com:8015/cnatool/css/list.css">
   <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
   <script src="http://maia.maiascript.com:8015/cnatool/js/menu.js"></script>
   <script src="http://maia.maiascript.com:8015/cnatool/js/sigma.min.js"></script>
   <script src="http://maia.maiascript.com:8015/cnatool/js/plugins/sigma.layout.forceAtlas2.min.js"></script>
   <script src="http://maia.maiascript.com:8015/cnatool/js/plugins/sigma.parsers.json.min.js"></script>
   <script src="http://maia.maiascript.com:8015/cnatool/js/plugins/sigma.parsers.gexf.min.js"></script>
   <script src="http://maia.maiascript.com:8015/maiastudio/js/maiascript.js"></script>
   <title>Complex Network Analysis Tool</title>
   <style type="text/css">
      #container {
         max-width: 400px;
         height: 400px;
         margin: auto;
      }
   </style>
</head>
<body style="background-color: black;" onload="maiavm.compile();">
   <div id="cssmenu">
      <ul>
         <li><a href="http://maia.maiascript.com">Maia</a></li>
         <li><a class="active" href="#">File</a>
            <ul>
               <li><a id="newFile" onclick="newFile()">New</a></li>
               <li><a id="openFile" onclick="openFile()">Open</a></li>
               <li><a id="saveFile" onclick="saveFile()">Save</a></li>
            </ul>
         </li>
         <li><a href="#">Help</a>
            <ul>
               <li><a id="showAboutDialog" onclick="showAboutDialog()">About</a></li>
               <li><a href="mailto:roberto@souzamonteiro.com">Contact</a></li>
            </ul>
         </li>
      </ul>
   </div>
   <div>
      <div class="split left">
         <ul class="list">
            <li class="item"><div class="label">Vertices:</div><div id="vertices" class="value"></div></li>
            <li class="item"><div class="label">Edges:</div><div id="edges" class="value"></div></li>
            <li class="item"><div class="label">Density:</div><div id="density" class="value"></div></li>
            <li class="item"><div class="label">Avg. Degree:</div><div id="averageDegree" class="value"></div></li>
            <li class="item"><div class="label">Avg. Clustering Coef.:</div><div id="averageClusteringCoefficient" class="value"></div></li>
            <li class="item"><div class="label">Avg. Shortest Path:</div><div id="averageShortestPath" class="value"></div></li>
            <li class="item"><div class="label">Global Efficiency:</div><div id="globalEfficiency" class="value"></div></li>
            <li class="item"><div class="label">Local Efficiency:</div><div id="localEfficiency" class="value"></div></li>
         </ul>
      </div>
      <div class="split right">
         <div id="container"></div>
      </div>
   </div>
   <script type="text/maiascript" src="http://maia.maiascript.com:8015/cnatool/maia/cna.maia"></script>
   <script type="text/javascript">
      function showGraph(data) {
         sigmaConfig = { 
            graph: data,
            container: "container",
            settings: {
               defaultNodeColor: "#ec5148"
            }
         }
         document.getElementById("container").innerHTML = "";
         var graph = new sigma(sigmaConfig);
      }
   </script>
   <script type="text/maiascript">
      function showProperties(adj) {
         vertices = document.getElementById("vertices")
         edges = document.getElementById("edges")
         density = document.getElementById("density")
         averageDegree = document.getElementById("averageDegree")
         averageClusteringCoefficient = document.getElementById("averageClusteringCoefficient")
         averageShortestPath = document.getElementById("averageShortestPath")
         globalEfficiency = document.getElementById("globalEfficiency")
         localEfficiency = document.getElementById("localEfficiency")

         dimAdj = core.dim(adj)
         nVertices = dimAdj[0] - 1
         degrees = cna.getDegrees(adj)
         clustering = cna.getClustering(adj)
         shortestPath = cna.getShortestPath(adj)
         vertexEfficiency = cna.getVertexEfficiency(shortestPath)
         subgraphEfficiency = cna.getSubgraphEfficiency(adj, vertexEfficiency, false)
         vertices.innerHTML = nVertices
         edges.innerHTML = matrix.count(adj, 1, 1, nVertices, nVertices) / 2
         density.innerHTML = string.sprintf("%.2f", cna.getDensity(adj))
         averageDegree.innerHTML = string.sprintf("%.2f", cna.getAverageDegree(degrees))
         averageClusteringCoefficient.innerHTML = string.sprintf("%.2f", cna.getAverageClustering(clustering))
         averageShortestPath.innerHTML = string.sprintf("%.2f", cna.getAverageShortestPath(shortestPath))
         globalEfficiency.innerHTML = string.sprintf("%.2f", cna.getGlobalEfficiency(vertexEfficiency, false))
         localEfficiency.innerHTML = string.sprintf("%.2f", cna.getLocalEfficiency(subgraphEfficiency, false))
      }

      function newFile() {
         win = window.open("index.html", "", "")
      }
      function openFile() {
         fileObject = {
            "fullFileName": "",
            "fileName": "",
            "fileExtension": "",
            "fileData": ""
         }

         function callBack(fileObject) {
            fileData = cna.pajekFileToJson(fileObject.fileData)
            showGraph(fileData)

            adj = cna.parsePajekFile(fileObject.fileData)
            showProperties(adj)
         }

         system.uploadFile(fileObject, callBack)
      }

      function saveFile() {
         
      }

      function showAboutDialog() {
         copyright = "Copyright (C) Roberto Luiz Souza Monteiro,\nRenata Souza Barreto,\nHernane Barrros de Borges Pereira.\n\nwww.maiascript.com"
         system.showMessageDialog(copyright)
      }
   </script>
</body>
<html>
